# リズムモード要件定義書

## 1. 概要

### 1.1 背景
現在の音楽ゲームアプリケーションはピアノとギターモードで音階を学習する機能を提供している。これに加えて、リズム感を養成するための「リズムモード」を実装する。

### 1.2 目的
- ジャズ演奏に必要なリズム感の習得
- タイミングとテンポキープ能力の向上
- リズムパターンの理解と実践
- より包括的な音楽学習体験の提供

## 2. 機能要件

### 2.1 基本機能

#### 2.1.1 リズムノーツ
- ドラムパッド方式の4つのパッドを使用
- 各パッドに異なるドラム音色を割り当て（キック、スネア、ハイハット、シンバル等）
- 上から下へ降下するリズムノーツ
- タイミングに合わせてパッドをタップ/クリック

#### 2.1.2 入力方式
- **キーボード入力**: D, F, J, K キーに4つのパッドを割り当て
- **MIDI入力**: MIDIドラムパッドやキーボードの特定ノートに対応
- **タッチ入力**: スマートフォン/タブレットでのタップ操作
- **マウス入力**: PCでのクリック操作

#### 2.1.3 譜面表示
- リズム譜（ドラム譜）の表示
- 各パッドに対応する記号表示
- メトロノーム表示（ビート位置の視覚的表示）

### 2.2 練習機能

#### 2.2.1 リズムパターン練習
- 基本的なリズムパターンのライブラリ
  - 4ビート、8ビート、16ビート
  - スウィング、シャッフル
  - ラテンリズム（ボサノバ、サンバ等）
  - ジャズ特有のリズムパターン

#### 2.2.2 テンポ練習
- BPM調整機能（40-300 BPM）
- 段階的なテンポアップ練習モード
- メトロノーム同期機能

#### 2.2.3 ポリリズム練習
- 3連符、5連符などの練習
- クロスリズムの練習
- リズムの重ね合わせ練習

### 2.3 ゲームモード

#### 2.3.1 判定システム
- タイミング判定
  - Perfect: ±30ms
  - Good: ±100ms
  - OK: ±200ms
  - Miss: それ以外
- 連続ヒット（コンボ）システム
- スコアリング（精度重視）

#### 2.3.2 難易度設定
- **Easy**: 基本的な4ビート、8ビート
- **Normal**: 16ビート、基本的なフィルイン
- **Hard**: 複雑なリズムパターン、速いテンポ
- **Expert**: ポリリズム、変拍子、即興的なリズム

### 2.4 学習支援機能

#### 2.4.1 視覚的ガイド
- 次に叩くパッドのハイライト表示
- リズムグリッド表示（拍の区切りを視覚化）
- ゴーストノート（お手本）表示

#### 2.4.2 聴覚的ガイド
- クリック音（メトロノーム）
- カウントイン機能
- リズムループ再生機能

#### 2.4.3 フィードバック
- リアルタイムの精度表示
- ミスしたタイミングの視覚的フィードバック
- 練習後の詳細な成績分析

## 3. UI/UX要件

### 3.1 画面レイアウト

```
┌─────────────────────────────────┐
│ モードタブ (練習/本番/曲選択)     │
├─────────────────────────────────┤
│ リズム譜表示エリア                │
├─────────────────────────────────┤
│ ノーツ降下エリア                  │
├─────────────────────────────────┤
│ ドラムパッドエリア（4パッド）      │
├─────────────────────────────────┤
│ コントロールパネル                │
└─────────────────────────────────┘
```

### 3.2 ドラムパッドデザイン
- 4つの正方形パッド
- 各パッドに楽器名とキー表示
- タップ/ヒット時のアニメーション効果
- カラーコーディング（視認性向上）

### 3.3 レスポンシブ対応
- PC: キーボード操作優先
- タブレット: タッチ操作最適化
- スマートフォン: 縦向き対応

## 4. 技術要件

### 4.1 パフォーマンス
- 低レイテンシ入力処理（<10ms）
- 60FPSの安定した描画
- 音声再生の正確なタイミング同期

### 4.2 音源管理
- Web Audio APIを使用した低レイテンシ再生
- ドラムサンプルの事前ロード
- 複数音の同時再生対応

### 4.3 データ構造
```typescript
interface RhythmNote {
  id: string;
  time: number; // 秒単位
  padIndex: number; // 0-3
  velocity?: number; // 0-127
  accent?: boolean;
}

interface RhythmPattern {
  id: string;
  name: string;
  bpm: number;
  timeSignature: string; // "4/4", "3/4" etc
  notes: RhythmNote[];
  difficulty: number;
}
```

## 5. 既存システムとの統合

### 5.1 共通利用コンポーネント
- 判定システム（タイミング判定ロジック）
- スコアリングシステム
- 音声再生システム（Tone.js）
- PIXI.js描画エンジン

### 5.2 モード切り替え
- 既存のピアノ/ギターモードとの切り替え
- 設定の共有（音量、レイテンシ調整等）
- 統一されたUI/UXデザイン

### 5.3 データ管理
- 練習履歴の保存
- スコアランキング
- お気に入りパターンの保存

## 6. 将来的な拡張

### 6.1 高度な機能
- カスタムリズムパターン作成
- リズムのインポート/エクスポート
- AIによるリズム生成
- リアルタイムセッション機能

### 6.2 教育的機能
- リズム理論の学習コンテンツ
- 段階的な学習カリキュラム
- 認定証/バッジシステム

## 7. 非機能要件

### 7.1 アクセシビリティ
- キーボードナビゲーション対応
- 色覚多様性対応
- スクリーンリーダー対応

### 7.2 パフォーマンス目標
- 初期ロード時間: 3秒以内
- 入力レイテンシ: 10ms以内
- CPU使用率: 30%以下

### 7.3 対応環境
- ブラウザ: Chrome 90+, Firefox 88+, Safari 14+
- デバイス: PC、タブレット、スマートフォン
- OS: Windows, macOS, iOS, Android