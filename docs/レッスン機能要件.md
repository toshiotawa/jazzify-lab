# レッスン機能要件と進捗

## 機能概要
ジャズ音楽学習ウェブアプリケーションのレッスン機能

## 実装済み機能

### ✅ レッスンナビゲーション機能 (2025-01-17)
- **レッスン詳細ページにナビゲーションボタンを追加**
  - 手前のレッスンに戻る
  - コースに戻る
  - 次のレッスンに進む
  
- **ブロック表記の改善**
  - 従来: "ブロック 1 (レッスン 1-5)"
  - 改善後: "ブロック 1"
  
- **エラーハンドリング実装**
  - コースの最初/最後でのナビゲーション制限
  - レッスン解放状態のチェック
  - ユーザーフレンドリーなエラーメッセージ
  - ブロック境界での適切な警告表示

- **パフォーマンス最適化 (2025-01-24)**
  - ナビゲーション情報のメモリキャッシュ（TTL: 5分）
  - キャッシュサイズ制限とクリーンアップ機能
  - ナビゲーション時の不要キャッシュ削除
  - デバウンシング機能でUI応答性向上
  - 処理中状態表示でユーザビリティ改善

- **実装ファイル**
  - `src/utils/lessonNavigation.ts` - ナビゲーション用ユーティリティ
  - `src/components/lesson/LessonDetailPage.tsx` - UI統合
  - `src/components/lesson/LessonPage.tsx` - ブロック表記修正

### ✅ 既存機能（継続中）
- レッスン動画視聴
- 実習課題システム
- 進捗管理とブロック解放
- スキップ機能（プラチナプラン）
- リアルタイム演奏判定

## 技術仕様

### ナビゲーション機能
```typescript
interface LessonNavigationInfo {
  previousLesson: Lesson | null;
  nextLesson: Lesson | null;
  canGoPrevious: boolean;
  canGoNext: boolean;
  course: {
    id: string;
    hasAccessToPrevious: boolean;
    hasAccessToNext: boolean;
  };
}
```

### エラーハンドリング
- レッスン解放状態の動的チェック
- ブロック境界での警告メッセージ
- ナビゲーション前のバリデーション
- ユーザー体験を重視したメッセージング

## 今後の拡張予定
- [ ] キーボードショートカット（矢印キー等）
- [ ] レッスン内でのセクションジャンプ
- [ ] 進捗可視化の改善
- [ ] オフライン対応

## 注意事項
- ナビゲーション機能は user_lesson_progress テーブルの is_unlocked フィールドに依存
- ブロック解放ロジックは既存のシステムを維持
- エラーメッセージは日本語ユーザー向けに最適化
