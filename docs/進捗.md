#希望
新機能について、どこまで実装が住んでいるか調査してください。ultrathinking必須。

##要望
**パフォーマンス**：Supabase 呼び出しのレイテンシ → キャッシュ & WebSocket サブスク活用  
Postgres + RLS + Realtimeで低レイテンシを狙う。

##残タスク
― UI/UXポリッシュ・細かな調整
― プラチナプラン高度機能 (課題提出・LINE連携)
― fetchWithCache 全API展開 & Realtime 連携統合テスト
― 全体的なパフォーマンス最適化

##構想
--------
・supabaseのmagic linkでログインさせたい。
supabase
初期画面を追加、

・ログインせずおためしボタン
・会員登録(メールアドレスを入力)

・ログイン(メールアドレスを入力)

・ログイン後
ログイン後、アカウントが存在しない場合、アカウントの登録
利用規約、プライバシーポリシーへの同意チェック後、アカウント登録
ニックネーム(日記やランキングに表示される)を登録。
そこがトップページになる

お試しプレイでも全てのタブは表示される。コミュニティタブの日記は中身はログインしないと見えないように。



・ヘッダー右端に会員登録/ログイン時はアカウントボタンを。ヘッダー左端にはトップページボタンを。ヘッダーは既存のものを流用する。

アカウントはモーダルで。
会員ランクを確認できる

会員ランクは
フリー、スタンダード、プレミアム、プラチナ。
ランクによって表示される要素に変化はないが、アクセスできる、曲、レッスン、ミッション/チャレンジに制限がある。


・管理画面を作りたい。
shadcn/ui や React-Hook-Formと組み合わせて曲登録ダッシュボードを追加したい（曲の管理方法をjsonハードコーディングから変更)
管理画面では会員のステータスを変更したい。


・ヘッダー右端のアカウントボタンの左にマイページボタンを設置

曲の記録が表示される。曲が一覧で表示される。
最高ランク、Bランク以上でのクリア回数を表示
レッスンの進捗状況も確認できる。

・無料会員では遊べる曲を制御(管理画面で制御)


・経験値システム
本番モード(ステージ)を終了すると経験値が得られる
会員ランクに応じて得られる経験値の倍率が違う。（プレミアム1.5x プラチナ2x)

再生速度によって得られる経験値が違う(1xがマックス、再生速度を落とすとその分だけ得点倍率が下がる)

スコアランクに応じて経験値が違う(Sランクで1000点とかかな。最低でも100点は入る)

移調してプレイすると1.3倍ボーナス

経験値テーブルはレベル1-10までは2000点で1レベル上がるくらい。
11-50は5000点で1レベル上がる。
51以降は20000点で1レベル上がる。

全期間のレベルランキングを作成する、
ニックネーム、レベル、会員ランク、クリアレッスン数が表示される。
(同レベルの場合は経験値順)


結果画面に獲得経験値と、ボーナスを表示(ボーナスは後述するがレッスンボーナス、ミッションボーナス、チャレンジボーナスもある)
レベルも表示(45 → 46 Level UP!)のような。
上がらなくても表示


・レッスン
プレミアム、プラチナプランはレッスンをプレイすることができる。(フリー、スタンダードでも数曲プレイ可能、管理画面でプレイ可能レッスンは制御できる。)
マイページ左端にレッスンボタンを用意。

レッスン→コース↛動画&曲という序列になっている。
動画数の制限はない(0でもOK)曲も制限はない(0でもOK)
しかしどちらかは1つは存在しないといけない。

コース一覧にコースの進捗バーを表示。
レッスン一覧では解放されていないレッスンには鍵マーク。
クリアしたレッスンにはクリア日とクリアマーク。

動画はvimeoで埋め込み。

曲は管理画面で追加する。
その曲のクリア条件を管理画面で指定する(キー、再生速度、スコアランク、クリア回数、(楽譜表示設定「ノート+コードorコードのみ」)。レッスンクリア条件テキストとして自動で埋め込む。)

例キー+-0で、再生速度1.0以上で、スコアランクB以上、楽譜表示設定「コードのみ」で10回クリア

すべての曲のクリア条件を達成することで、プレミアムプランでは先のレッスンに進める。

プラチナプランではLINE上で講師とやり取りして提出するような課題があり、その課題説明宿題も管理画面で書く
提出課題のチェックボタンは生徒が押すことができる。
課題提出5日間、のような課題の場合1.2.3.4.5日目のチェックボックスを生徒が埋めていく。


プラチナプランではスキップボタンを押し、レッスンをスキップすることができる。(確認モーダルを出す)
プラチナプランのレッスンの解放状態、完了状態の管理は管理画面から管理者が行うこともできる。
マイページモーダルで進捗を確認することもできる
(例コースドロップダウン→
レッスン1 完了✓・解放✓
レッスン2 完了　・解放✓
レッスン3 完了　・解放✓
レッスン4 完了　・解放
レッスン5 完了　・解放
のように)


プレミアムプランではスキップボタンを押せないように。
レッスンの曲を本番モードでプレイする場合、通常より経験値2倍入る。



・ウィークリーチャレンジ、マンスリーミッションを管理画面で追加できるように
ウィークリーチャレンジ、マンスリーミッション

それぞれ自由に曲、クリア条件(キー、再生速度、スコアランク、クリア回数、(楽譜表示設定「ノート+コードorコードのみ」)を指定し、
レッスンクリア条件テキストとして自動で埋め込む。

マイページにチャレンジ、ミッションは表示されていて、進捗バー(クリア回数 5/10回のように)、が表示される。

チャレンジ、ミッションの達成報酬はそれぞれ翌シーズン経験値1.3倍獲得。

そのシーズンと一つ前シーズンのランキングを表示させる、先着100名まで、フォーマットはレベルランキングと同様のものを使用。
曲は既存の曲の中から選択させるようにし、



・ユーザーのトップページダッシュボード？
ダッシュボードには、お知らせ、チャレンジとミッションが表示される。
お知らせは管理画面で編集できる(リンク付きテキストも可能)


・曲選択の曲一覧をシンプル(今はスペースが大きいかも)
アーティストアルファベット順→曲名アルファベット順。

・結果画面に次にプレイするべきおススメ曲を表示(通常プレイ時、レッスンではない)
ミッション・チャレンジ達成していないならその曲。



・練習日記
ヘッダーにコミュニティタブを用意

そこではその日のユーザーの練習日記が表示される。

練習日記(1日1記事)作成することができる。
編集はとコメントは可能。
他のユーザーはいいねを押すことができる。

ユーザー名をクリックすると、そのユーザーの練習日記ページに飛ぶことができる。

日記で経験値が入るように。



### メモ
- 60FPS維持は最低条件**: `unifiedFrameController` 使用必須、競合ループ禁止!!!!
- Supabase 管理画面 → Schedules → New schedule で `reset-season-multiplier` を定期実行設定