# Supabase OTP設定手順

## 問題の原因
Supabaseの`signInWithOtp`は、デフォルトでマジックリンクを送信します。実際のOTPコード（6桁の数字）を送信するには、メールテンプレートの設定変更が必要です。

## 設定手順

### 1. Supabaseダッシュボードでメールテンプレートを変更

1. Supabaseプロジェクトのダッシュボードにログイン
2. 左側のメニューから「Authentication」→「Email Templates」に移動
3. 「Magic Link」テンプレートを選択

### 2. テンプレートの変更

デフォルトのテンプレート：
```html
<h2>Magic Link</h2>

<p>Follow this link to login:</p>
<p><a href="{{ .ConfirmationURL }}">Log In</a></p>
```

OTPコード用のテンプレートに変更：
```html
<h2>ログイン認証コード</h2>

<p>以下の6桁の認証コードを入力してください：</p>
<h1 style="font-size: 32px; font-weight: bold; letter-spacing: 5px; color: #333;">{{ .Token }}</h1>
<p>このコードは60分間有効です。</p>
<p>このメールに心当たりがない場合は、無視してください。</p>
```

### 3. 件名の変更

- Subject: `Your Login Code: {{ .Token }}` または `認証コード: {{ .Token }}`

### 4. その他の推奨設定

1. **OTP有効期限**: `config.toml`で設定済み（3600秒 = 1時間）
2. **OTP長さ**: 6桁（設定済み）

## コードの修正点

現在のコードは既にOTP対応になっているため、Supabase側のメールテンプレートを変更するだけで動作します。

## テスト手順

1. メールテンプレートを変更後、保存
2. アプリケーションで「認証コード」モードを選択
3. メールアドレスを入力して送信
4. メールで6桁のコードを受信することを確認
5. アプリでコードを入力して認証

## 注意事項

- マジックリンクとOTPコードを同時に使用する場合は、別々のメールテンプレートを設定する必要があります
- Supabaseの無料プランでは、メールテンプレートのカスタマイズに制限がある場合があります