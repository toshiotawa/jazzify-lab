# Cloudflare R2 カスタムドメイン設定ガイド

## R2.dev URLの制限事項

### 警告の意味
```
この URL はレート制限があり、本番環境での使用は推奨されません
```

**R2.dev URL（pub-xxxxx.r2.dev）の制限：**
- ⚠️ レート制限あり（大量アクセスで制限される可能性）
- ⚠️ Cloudflareの高度な機能（WAF、キャッシング等）が使えない
- ⚠️ 本番環境には不適切

## あなたの選択肢

### オプション1: 開発・テスト用途なら R2.dev URLでOK
**こんな場合に適している：**
- 開発環境での使用
- アクセス数が少ない（日に数百程度）
- まずはR2を試したい
- プロトタイプ開発

**設定方法：**
```env
VITE_R2_PUBLIC_URL=https://pub-xxxxx.r2.dev
```

### オプション2: カスタムドメインを設定（本番環境推奨）
**こんな場合に必要：**
- 本番環境での使用
- 大量のアクセスが予想される
- 高速な配信が必要
- プロフェッショナルなURL（例：cdn.jazzify.jp）

## カスタムドメインの設定方法

### 方法A: サブドメインを使用（推奨）
NetlifyでメインサイトをホストしながらR2用のサブドメインを作成

#### 1. サブドメインを決める
```
例：
- cdn.jazzify.jp
- assets.jazzify.jp
- media.jazzify.jp
```

#### 2. Cloudflareでサブドメインを設定
1. **ドメインをCloudflareに追加しない場合**（Netlify DNSのまま）
   - NetlifyのDNS設定でCNAMEレコードを追加
   ```
   cdn.jazzify.jp CNAME [R2バケット名].r2.dev
   ```

2. **ドメインをCloudflareに追加する場合**
   - CloudflareのDNSでCNAMEレコードを追加
   - R2の設定でカスタムドメインを有効化

#### 3. R2でカスタムドメインを設定
1. R2バケット > Settings > Custom Domains
2. 「Connect Domain」をクリック
3. `cdn.jazzify.jp` を入力
4. 指示に従ってDNS設定を完了

### 方法B: 別ドメインを使用
jazzify.jpとは別のドメインをR2専用に使用

```
例：
- jazzify-cdn.com
- jazzifyassets.com
```

## 推奨構成

### 小規模プロジェクト / 開発中
```
構成：
- メインサイト: jazzify.jp (Netlify)
- R2ストレージ: pub-xxxxx.r2.dev（そのまま使用）

理由：
- 設定がシンプル
- 開発中は十分な性能
- 後からカスタムドメインに移行可能
```

### 本番環境 / 大規模プロジェクト
```
構成：
- メインサイト: jazzify.jp (Netlify)
- R2ストレージ: cdn.jazzify.jp (カスタムドメイン)

理由：
- レート制限なし
- 高速配信
- プロフェッショナルな印象
```

## 実装の更新

カスタムドメインを使用する場合の環境変数：

```env
# 開発環境
VITE_R2_PUBLIC_URL=https://pub-xxxxx.r2.dev

# 本番環境（カスタムドメイン設定後）
VITE_R2_PUBLIC_URL=https://cdn.jazzify.jp
```

## 判断基準

### R2.dev URLで始めるべき場合
- ✅ まだ開発初期段階
- ✅ アクセス数が少ない
- ✅ すぐに始めたい
- ✅ 複雑な設定を避けたい

### カスタムドメインを設定すべき場合
- ✅ 本番環境での運用
- ✅ 月間1万以上のアクセス
- ✅ 画像・動画を大量に配信
- ✅ パフォーマンスが重要

## まとめ

**今すぐ決める必要はありません！**

1. まずはR2.dev URLで開発を進める
2. アクセス数が増えてきたらカスタムドメインを検討
3. 移行は後からでも簡単にできる

開発段階ではR2.dev URLで十分です。本番環境に移行する際にカスタムドメインを設定すれば問題ありません。